---
// Enhanced Giscus.astro with DaisyUI theme detection and view transitions support
---

<div class="giscus-wrapper card shadow-xl p-4 mt-8">
  <h3 class="text-xl font-bold mb-4">Comments</h3>
  <div class="giscus"></div>
</div>

<section class="mx-auto mt-12">
  <script>
    // Function to load Giscus with the current path
    function loadGiscus() {
      // First, remove any existing Giscus script to avoid duplicates
      const existingScript = document.querySelector('.giscus-script');
      if (existingScript) {
        existingScript.remove();
      }

      // Remove any existing giscus widgets
      const existingIframe = document.querySelector('iframe.giscus-frame');
      if (existingIframe) {
        existingIframe.remove();
      }

      // Create and append a new Giscus script with the current path
      const script = document.createElement('script');
      script.className = 'giscus-script';
      script.src = "https://giscus.app/client.js";
      script.setAttribute('data-repo', "alehdezp/astro-aleraptor");
      script.setAttribute('data-repo-id', "R_kgDOOWEucg");
      script.setAttribute('data-category', "Blog Comments");
      script.setAttribute('data-category-id', "DIC_kwDOOWEucs4CpzXE");
      script.setAttribute('data-mapping', "pathname");
      script.setAttribute('data-strict', "0");
      script.setAttribute('data-reactions-enabled', "1");
      script.setAttribute('data-emit-metadata', "0");
      script.setAttribute('data-input-position', "top");
      script.setAttribute('data-theme', "preferred_color_scheme");
      script.setAttribute('data-lang', "en");
      script.setAttribute('data-loading', "lazy");
      script.crossOrigin = "anonymous";
      script.async = true;

      document.querySelector('section.mx-auto').appendChild(script);
    }

    // Load Giscus on initial page load
    document.addEventListener('DOMContentLoaded', loadGiscus);

    // Reload Giscus after Astro view transitions
    document.addEventListener('astro:page-load', loadGiscus);
    document.addEventListener('astro:after-swap', loadGiscus);
  </script>
</section>
